<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TI Predictions</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
  <style>
  .nav-pills > li > a.active {
      background-color: #cbc8da !important;
  }</style>
</head>
<body>
  {% if tabs is not none %}
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Prediction Model:</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link{% if output_file == 'elo' %} active" aria-current="page" {% else %}" {% endif %}href="elo{{tabs['active'][1]}}">Elo Ratings</a>
          </li>
          <li class="nav-item">
            <a class="nav-link{% if output_file == 'fixed' %} active" aria-current="page" {% else %}" {% endif %} href="fixed{{tabs['active'][1]}}">Fixed Ratings</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="dayDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Day
            </a>
            <ul class="dropdown-menu" aria-labelledby="dayDropdown">
              {% for tabname, suffix in tabs["all"] %}
              <li><a class="dropdown-item" href="{{output_file}}{{suffix}}">{{tabname}}</a></li>
              {% endfor %}
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="eventDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Event
            </a>
            <ul class="dropdown-menu" aria-labelledby="eventDropdown">
              <li><a class="dropdown-item" href="../ti10/elo.html">TI 10</a></li>
              <li><a class="dropdown-item" href="../ti9/elo.html">TI 9</a></li>
              <li><a class="dropdown-item" href="../ti8/elo.html">TI 8</a></li>
              <li><a class="dropdown-item" href="../ti7/elo.html">TI 7</a></li>
            </ul>
          </li>
        </ul>
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="../ti10/elo_history.html">Rating Histories</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>{% endif %}
<div class="container mt-3 mb-3" style="max-width: 1500px">
  <h1 class="text-center">{{title}} Predictions</h1>
  <h6 class="text-center">{{n_samples}} samples <small><sup><a style="color: black; text-decoration: none" href="#footnote">*</a></sup></small></h6>
  <h6 class="text-center">Updated {{timestamp}} UTC</h6>
  <hr>
  <div class="d-flex justify-content-around flex-wrap">
    {% for group in ['a', 'b'] %}
    <div class="container" style="max-width: 725px;">
      <h2>GROUP {{group|upper}}</h2>
      <h3 class="pt-2">Bracket Probabilities</h3>
      <div class="table-responsive">
        <table class="table table-sm">
        <thead>
          <tr>
            <th scope="col">Team</th>
            <th scope="col">Rating</th>
            <th scope="col">Record</th>
            <th scope="col">Upper Bracket</th>
            <th scope="col">Lower Bracket</th>
            <th scope="col">Eliminated</th>
          </tr>
        </thead>
        <tbody class="table-light">
        {% for team, prob_dict in gs_prob_strs[group].items()|reverse %}
        <tr>
          <td><img src="image/{{team}}.png" height=20px> {{team}}</td>
          <td class="text-center">{{ratings[team]}}</td>
          <td class="text-center">{{records[team][0]}}-{{records[team][1]}}-{{records[team][2]}}</td>
          <td class="text-center" style="background-color: #{{prob_dict['upper-color']}}">{{prob_dict["upper"]|e}}</td>
          <td class="text-center" style="background-color: #{{prob_dict['lower-color']}}">{{prob_dict["lower"]|e}}</td>
          <td class="text-center" style="background-color: #{{prob_dict['elim-color']}}">{{prob_dict["elim"]|e}}</td>
        </tr>
        {% endfor %}
        </tbody>
        </table>
      </div>
      <h3 class="pt-2">Match Probabilities</h3>
      <div class="accordion pb-4" id="matches-{{group}}-accordion">
        {% for day in range(4) %}
        <div class="accordion-item">
          <h2 class="accordion-header" id="day-{{day}}-head-{{group}}">
            <button class="accordion-button{% if day != 0 %} collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#day-{{day}}-col-{{group}}" aria-expanded="{% if day == 0 %}true{% else %}false{% endif %}" aria-controls="day-{{day}}-col-{{group}}">
              Day {{day + 1}}
            </button>
          </h2>
          <div id="day-{{day}}-col-{{group}}" class="accordion-collapse collapse{% if day == 0 %} show{% endif %}" aria-labelledby="day-{{day}}-head-{{group}}">
            <div class="accordion-body">
              <div class="table-responsive">
              <table class="table table-sm" style="max-width: 600px;">
              <thead>
                <tr>
                  <th scope="col"></th>
                  <th class="text-center" scope="col">2-0</th>
                  <th class="text-center" scope="col">1-1</th>
                  <th class="text-center" scope="col">0-2</th>
                  <th scope="col"></th>
                </tr>
              </thead>
              <tbody class="table-light">
                {% for match in matches[group][day] %}
                <tr>
                  <td {% if match['result'] == 2 %}style="background-color: #ccffcc"
                    {%- elif match['result'] == 1 %}style="background-color: #fafacc"
                    {%- elif match['result'] == 0 %}style="background-color: #ffcccc"
                    {%- endif %}><img src="image/{{match['teams'][0]}}.png" height=20px><span class="d-none d-sm-block d-md-inline"> {{match['teams'][0]}}</span>{% if match['result'] != -1 %} <b>({{match['result']}})</b>{% endif %}</td>
                  <td class="text-center" style="background-color: #{{match['colors'][0]}}">{{match['probs'][0]|e}}</td>
                  <td class="text-center" style="background-color: #{{match['colors'][1]}}">{{match['probs'][1]|e}}</td>
                  <td class="text-center" style="background-color: #{{match['colors'][2]}}">{{match['probs'][2]|e}}</td>
                  <td {% if match['result'] == 0 %}style="background-color: #ccffcc"
                    {%- elif match['result'] == 1 %}style="background-color: #fafacc"
                    {%- elif match['result'] == 2 %}style="background-color: #ffcccc"
                    {%- endif %}><img src="image/{{match['teams'][1]}}.png" height=20px><span class="d-none d-sm-block d-md-inline"> {{match['teams'][1]}}</span>{% if match['result'] != -1 %} <b>({{2 - match['result']}})</b>{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
              </table>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      <h3 class="pt-2">Group Stage Rank Probabilities</h3>
      <div class="table-responsive">
        <table class="table table-sm">
        <thead>
          <tr>
            <th scope="col">Team</th>
            <th class="text-center" scope="col">1st</th>
            <th class="text-center" scope="col">2nd</th>
            <th class="text-center" scope="col">3rd</th>
            <th class="text-center" scope="col">4th</th>
            <th class="text-center" scope="col">5th</th>
            <th class="text-center" scope="col">6th</th>
            <th class="text-center" scope="col">7th</th>
            <th class="text-center" scope="col">8th</th>
            <th class="text-center" scope="col">9th</th>
          </tr>
        </thead>
        <tbody class="table-light">
        {% for team, prob_dict in gs_prob_strs[group].items()|reverse %}
        <tr>
          <td><img src="image/{{team}}.png" height=20px><span class="d-none d-sm-block d-md-inline"> {{team}}</span></td>
          {% for i in range(9) %}
          <td style="background-color: #{{prob_dict['%d-color' % i]}}" class="text-center">{{prob_dict[i]|e}}</td>
          {% endfor %}
        </tr>
        {% endfor %}
        </tbody>
        </table>
      </div>
      <h3 class="pt-2">Tiebreak Probabilities</h3>
      <div class="table-responsive">
        <table class="table table-sm">
        <thead>
          <tr>
            <th scope="col">Boundary</th>
            <th class="text-center" scope="col">2-way</th>
            <th class="text-center" scope="col">3-way</th>
            <th class="text-center" scope="col">4-way</th>
            <th class="text-center" scope="col">5-way</th>
            <th style="border-left: 1px solid black;" class="text-center" scope="col">Overall</th>
          </tr>
        </thead>
        <tbody class="table-light">
        {% for boundary in [3, 7] %}
        <tr>
          <td>{% if boundary == 3 %}Upper Bracket{% else %}Elimination{% endif %}</td>
          {% for i in range(4) %}
          <td style="background-color: #{{tiebreak_prob_strs[group][boundary][i]['color']}}" class="text-center">{{tiebreak_prob_strs[group][boundary][i]["prob"]}}</td>
          {% endfor %}
          <td style="border-left: 1px solid black; background-color: #{{tiebreak_prob_strs[group][boundary][-1]['color']}}" class="text-center">{{tiebreak_prob_strs[group][boundary][-1]["prob"]}}</td>
        </tr>
        {% endfor %}
        </tbody>
        </table>
      </div>
    <h3 class="mt-4 text-center">Group Stage Rank by Record</h3>
      This table shows what group stage ranks a team can an end up at if they achieve a particular win-loss record. Note that probabilities will have high error if the win-loss record is highly unlikely.<br><br>
      <ul class="nav nav-pills nav-fill">
        {% for team in point_ranks_strs[group].keys() %}
        <li class="nav-item">
          <a href="#{{team|replace(' ','')|replace('.','')}}-point-rank" id="{{team|replace(' ','')|replace('.','')}}-point-rank-pill" class="text-dark nav-link{% if loop.index == 1 %} active{% endif %}" data-bs-toggle="tab" aria-controls="{{team|replace(' ','')|replace('.','')}}-point-rank"{% if loop.index == 1 %} aria-current="page"{% endif %}>
          <img src="image/{{team}}.png" height=20px><br>
          ({{records[team][0]*2 + records[team][1]}}-{{records[team][2]*2 + records[team][1]}})
        </a></li>
        {% endfor %}
      </ul>
      <div class="tab-content">
      {% for team in point_ranks_strs[group].keys() %}
      <div class="tab-pane {% if loop.index == 1 %} show active{% endif %}" id="{{team|replace(' ','')|replace('.','')}}-point-rank" aria-labelledby="{{team|replace(' ','')|replace('.','')}}-point-rank-tab">
        <div class="container-fluid">
        <div class="table-responsive">
          <table class="table table-sm" style="max-width: 900px;">
          <thead>
            <tr>
              <th class="text-center" scope="col" colspan=2>Record</th>
              <th class="text-center" scope="col" colspan=9>Group Rank</th>
            </tr>
            <tr>
              <th style="width: 75px" class="text-center" scope="col">W - L</th>
              <th style="width: 65px" class="text-center" scope="col">Prob</th>
              {% for i in range(1, 10) %}
              <th style="width: 65px" class="text-center" scope="col">{{i}}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody class="table-light">
          {% for points, rank_dict in point_ranks_strs[group][team].items() %}
          <tr>
            <td class="text-center">{{points}} - {{16 - points}}</td>
            <td class="text-center" style="background-color: #{{record_probs[group][team][points]['color']}}; border-right: 1px solid black">{{record_probs[group][team][points]['prob']|e}}</td>
            {% for rank, prob_dict in rank_dict.items() %}
            <td style="background-color: #{{prob_dict['color']}}" class="text-center">{{prob_dict['prob']|e}}</td>
            {% endfor %}
          </tr>
          {% endfor %}
          </tbody>
          </table>
        </div>
        </div>
      </div>
      {% endfor %}
      </div>
    </div>
    {% endfor %}
  </div>
  <h2 class="mt-4 text-center">Final Rank Probabilities</h2>
  <div class="container d-flex flex-column align-items-center">
    <div class="container d-flex justify-content-center">
      <div class="table-responsive">
        <table class="table table-sm" style="max-width: 900px;">
        <thead>
          <tr>
            <th scope="col">Team</th>
            <th style="width: 65px" class="text-center" scope="col">17 - 18</th>
            <th style="width: 65px" class="text-center" scope="col">13 - 16</th>
            <th style="width: 65px" class="text-center" scope="col">9 - 12</th>
            <th style="width: 65px" class="text-center" scope="col">7 - 8</th>
            <th style="width: 65px" class="text-center" scope="col">5 - 6</th>
            <th style="width: 65px" class="text-center" scope="col">4</th>
            <th style="width: 65px" class="text-center" scope="col">3</th>
            <th style="width: 65px" class="text-center" scope="col">2</th>
            <th style="width: 65px" class="text-center" scope="col">1</th>
          </tr>
        </thead>
        <tbody class="table-light">
        {% for team, prob_dict in final_prob_strs.items()|reverse %}
        <tr>
          <td><img src="image/{{team}}.png" height=20px><span class="d-none d-lg-block d-xl-inline"> {{team}}</span></td>
          {% for i in range(9) %}
          <td style="background-color: #{{prob_dict[i]['color']}}" class="text-center">{{prob_dict[i]['prob']|e}}</td>
          {% endfor %}
        </tr>
        {% endfor %}
        </tbody>
        </table>
      </div>
    </div>
    <div id="footnote" class="pt-4">
      <p><small><sup>*</sup> Due to the nature of sampling it is impossible to completely guarantee an outcome. Outcomes are marked with <b>✓</b> or <b>-</b> if they always or never occur across all simulations. For this report ({{n_samples}} samples), outcomes that occur at least {{100/n_samples}}% of the time will be detected with at least 63% probability and outcomes that occur at least {{100/(n_samples/10)}}% of the time will be correctly detected with at least 99.99% probability.</small></p>
      <p>Source code and model details can be found <a href="https://github.com/d2mcs/d2mcs.github.io">here</a>.</p>
    </div>
  </div>
  </div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
</body>
